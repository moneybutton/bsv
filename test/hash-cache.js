/* global describe,it */
'use strict'
import { HashCache } from '../lib/hash-cache'
import should from 'should'

describe('HashCache', function () {
  let prevoutsHashBuf = Buffer.from('01'.repeat(32), 'hex')
  let sequenceHashBuf = Buffer.from('02'.repeat(32), 'hex')
  let outputsHashBuf = Buffer.from('03'.repeat(32), 'hex')

  it('should satisfy this basic API', function () {
    let hashCache = new HashCache(prevoutsHashBuf, sequenceHashBuf, outputsHashBuf)
    should.exist(hashCache)
    hashCache.prevoutsHashBuf.length.should.equal(32)
    hashCache.sequenceHashBuf.length.should.equal(32)
    hashCache.outputsHashBuf.length.should.equal(32)
  })

  describe('#fromBuffer', function () {
    it('should parse this known message', function () {
      let hashCache = new HashCache().fromBuffer(new HashCache(prevoutsHashBuf, sequenceHashBuf, outputsHashBuf).toBuffer())
      hashCache.toHex().should.equal('7b22707265766f75747348617368427566223a2230313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031222c2273657175656e636548617368427566223a2230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032222c226f75747075747348617368427566223a2230333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033227d')
    })
  })

  describe('#toBuffer', function () {
    it('should parse this known message', function () {
      let hashCache = new HashCache(prevoutsHashBuf, sequenceHashBuf, outputsHashBuf)
      hashCache
        .toBuffer()
        .toString('hex')
        .should.equal('7b22707265766f75747348617368427566223a2230313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031222c2273657175656e636548617368427566223a2230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032222c226f75747075747348617368427566223a2230333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033227d')
    })
  })

  describe('#fromJSON', function () {
    it('should parse this known json hashCache', function () {
      new HashCache()
        .fromJSON(JSON.parse('{"prevoutsHashBuf":"0101010101010101010101010101010101010101010101010101010101010101","sequenceHashBuf":"0202020202020202020202020202020202020202020202020202020202020202","outputsHashBuf":"0303030303030303030303030303030303030303030303030303030303030303"}'))
        .toHex()
        .should.equal('7b22707265766f75747348617368427566223a2230313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031303130313031222c2273657175656e636548617368427566223a2230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032303230323032222c226f75747075747348617368427566223a2230333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033303330333033227d')
    })
  })

  describe('#toJSON', function () {
    it('should create this known message', function () {
      JSON.stringify(new HashCache(prevoutsHashBuf, sequenceHashBuf, outputsHashBuf).toJSON()).should.equal(
        '{"prevoutsHashBuf":"0101010101010101010101010101010101010101010101010101010101010101","sequenceHashBuf":"0202020202020202020202020202020202020202020202020202020202020202","outputsHashBuf":"0303030303030303030303030303030303030303030303030303030303030303"}'
      )
    })
  })
})
